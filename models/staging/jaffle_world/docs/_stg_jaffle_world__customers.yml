models:
  - name: stg_jaffle_world__customers
    description: >
      This model serves as a staging layer for customer data 
      from the 'jaffle_world' source. It standardizes and 
      renames fields for consistency and ease of use in 
      downstream models.
    columns:
      - name: customer_id
        description: A unique identifier for each customer.
        data_tests:
          - unique 
          - not_null
          
      - name: address_id
        description: >
          The identifier for the address associated with the customer.

      - name: first_name
        description: The first name of the customer.

      - name: last_name
        description: The last name of the customer.

      - name: email
        description: The email address of the customer.

      - name: phone
        description: The phone number of the customer.

      - name: created_at
        description: The timestamp when the customer record was created.

      - name: updated_at
        description: The timestamp when the customer record was last updated.

unit_tests:
  - name: test_is_valid_email_address
    model: stg_jaffle_world__customers
    description: >
      Check that is_valid_email logic captures of our known edge cases:
      - emails that have a .com without domain, like nodomain@.com
      - emails that have a truncated domain address, like truncated@domain.c
      - emails that have a missing dot in the domain, like missingdot@domaincom
      - emails with no @, like noat.com
      Additionally, we should check we're not marking emails which are valid 
      that contain special characters, such as:
      - c+berger@jaffle-shop.com
      - d.horner@jaffle.com
    given:
      - input: source('jaffle_world', 'customers')
        rows:
          - {email: nodomain@.com}
          - {email: truncated@domain.c}
          - {email: missingdot@domaincom}
          - {email: noat.com}
          - {email: c+berger@jaffle-shop.com}
          - {email: d.horner@jaffle.com}
    expect:
      rows:
        - {email: nodomain@.com, is_valid_email: false}
        - {email: truncated@domain.c, is_valid_email: false}
        - {email: missingdot@domaincom, is_valid_email: false}
        - {email: noat.com, is_valid_email: false}
        - {email: c+berger@jaffle-shop.com, is_valid_email: true}
        - {email: d.horner@jaffle.com, is_valid_email: true}