models:
  - name: int_employees
    description: >
      This model integrates employee data with store and warehouse information
      to provide a comprehensive view of employee roles and locations. It adjusts roles
      for store managers and categorizes employees into types such as store, warehouse,
      corporate, and executive. The model also consolidates location identifiers and
      names for employees based on their roles and associated locations.
    columns:
      - name: employee_id
        description: A unique identifier for each employee.

      - name: first_name
        description: The first name of the employee.

      - name: last_name
        description: The last name of the employee.

      - name: full_name
        description: The full name of the employee, combining first and last names.

      - name: email
        description: The email address of the employee.

      - name: phone
        description: The phone number of the employee.

      - name: hired_at
        description: The timestamp when the employee was hired.

      - name: terminated_at
        description: The timestamp when the employee was terminated, if applicable.

      - name: role
        description: The role of the employee, adjusted for store managers.

      - name: employee_type
        description: >
          The category of the employee, such as store, warehouse, corporate,
          or executive.

      - name: location_ids
        description: >
          Identifiers for the locations associated with the employee, such
          as store or warehouse IDs.

      - name: location_names
        description: >
          Names of the locations associated with the employee, such as store
          or warehouse names.
          
unit_tests:
  - name: test_is_valid_employee_type
    model: int_employees
    description: >
      Check that employee_type logic captures of our known cases:
      - If role starts with 'store_' return 'store'
      - If role starts with 'warehouse_' return 'warehouse'
      - If role starts with 'regional_' return 'corporate'
      - If role equals 'founder' return 'executive'
    given:
      - input: ref('stg_jaffle_world__employees')
        rows:
          - {employee_id: 1, store_id: 1, warehouse_id: 1, role: store_clerk}
          - {employee_id: 2, store_id: 2, warehouse_id: 2, role: warehouse_driver}
          - {employee_id: 3, store_id: 3, warehouse_id: 3, role: regional_vp}
          - {employee_id: 4, store_id: 4, warehouse_id: 4, role: founder}
          - {employee_id: 5, store_id: 5, warehouse_id: 5, role: founding_clerk}
          - {employee_id: 6, store_id: 6, warehouse_id: 6, role: region_1_supervisor}
      - input: ref('int_stores')
        rows:
          - {store_id: 1, regional_manager_id: 1}
          - {store_id: 2, regional_manager_id: 2}
          - {store_id: 3, regional_manager_id: 3}
          - {store_id: 4, regional_manager_id: 4}
          - {store_id: 5, regional_manager_id: 5}
          - {store_id: 6, regional_manager_id: 6}
      - input: ref('stg_jaffle_world__warehouses')
        rows:
          - {warehouse_id: 1}
          - {warehouse_id: 2}
          - {warehouse_id: 3}
          - {warehouse_id: 4}
          - {warehouse_id: 5}
          - {warehouse_id: 6}
    expect:
      rows:
        - {employee_id: 1, employee_type: store}
        - {employee_id: 2, employee_type: warehouse}
        - {employee_id: 3, employee_type: corporate}
        - {employee_id: 4, employee_type: executive}
        - {employee_id: 5, employee_type: null}
        - {employee_id: 6, employee_type: null}
